name: Sync To Gitee

on:
  #push:
    #branches: [ main ]  # å¯æ ¹æ®éœ€è¦ä¿®æ”¹åˆ†æ”¯
  schedule:
    - cron: '0 5 * * *'  # æ¯å¤© UTC æ—¶é—´ 1:00ï¼ˆå³åŒ—äº¬æ—¶é—´ 9:00ï¼‰

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (required by git-mirror-action)
        uses: actions/checkout@v4

      - name: Sync to Gitee with Retry
        env:
          SSH_PRIVATE_KEY: ${{ secrets.GITEE_RSA_PRIVATE_KEY }}
        run: |
          MAX_RETRIES=3
          RETRY_DELAY=10

          for i in $(seq 1 $MAX_RETRIES); do
            echo "ğŸ”„ Attempt $i of $MAX_RETRIES to sync to Gitee..."

            # ç›´æ¥è°ƒç”¨ git-mirror-action çš„ Docker å‘½ä»¤
            docker run --rm \
              -e SSH_PRIVATE_KEY \
              -v "$PWD:/github/workspace" \
              wearerequired/git-mirror-action:master \
              "git@github.com:MaaAssistantArknights/MaaResource.git" \
              "git@gitee.com:keithchow/MaaResource.git" \
              "false"

            if [ $? -eq 0 ]; then
              echo "âœ… Sync succeeded on attempt $i"
              break
            else
              echo "âŒ Attempt $i failed. Retrying in $RETRY_DELAY seconds..."
              sleep $RETRY_DELAY
            fi

            if [ $i -eq $MAX_RETRIES ]; then
              echo "ğŸ’¥ All $MAX_RETRIES attempts failed. Exiting."
              exit 1
            fi
          done
